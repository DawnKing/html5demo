<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parallel Viewing Projections</title>
  <script type="text/javascript" src="utils.js"></script>

  <style>
    #con {
      position: absolute;
      width: 500px;
      height: 500px;
    }
    #btn {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
<div id="con">
  <canvas id="container" width="1000" height="800"></canvas>
  <script>
    var vertexData = [
      [200, 100, 200], [400, 100, 200], [400, 100, 400], [200, 100, 400],
      [100, 200, 150], [500, 200, 150], [500, 200, 500], [100, 200, 500]
    ];
    var indexData = [0, 1, 2, 3, 7, 6, 2, 6, 5, 1, 5, 4, 0, 4, 7, 3];
    var moveCanvas = [0, 0];
    var context;

    var init = function () {
      var canvas = document.getElementById("container");
      context = canvas.getContext("2d");
      context.translate(200, 200);
      drawVertex(vertexData, "red");
    }();

    function drawVertex(vertexData, color) {
      var drawList = [];
      for (var i = 0; i < indexData.length; i++) {
        drawList.push(vertexData[indexData[i]]);
      }
      drawPolygon(context, drawList, color);
    }

    function draw(strategyName) {
      var canvas = document.getElementById("container");
      var context = canvas.getContext("2d");

      // clear screen
      context.clearRect(-200, -200, canvas.width, canvas.height);

      // 3d geometric transformation
      var matrix = drawStrategy[strategyName]["get"]();
      var result = [];
      for (var i = 0; i < vertexData.length; i++) {
        var p = dotProduct(vertexData[i], matrix);
        result.push(p);
        console.log(strategyName, p.toString());
      }

      drawVertex(result, "green");
    }

    var drawStrategy = {
      frontView : {
        get : function () {
          return [
            1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 0, 0,
            0, 0, 0, 1
          ];
        }
      },
      topView : {
        get : function () {
          var a = [
            1, 0, 0, 0,
            0, 0, 0, 0,
            0, 0, 1, 0,
            0, 0, 0, 1
          ];
          // Rotate 90 degrees counterclockwise around the X axis.
          var Trx = [
            1, 0, 0, 0,
            0, Math.cos(-Math.PI/2), Math.sin(-Math.PI/2), 0,
            0, -Math.sin(-Math.PI/2), Math.cos(-Math.PI/2), 0,
            0, 0, 0, 1
          ];
          return matrixDotProductMatrix(a, Trx);
        }
      },
      sideView : {
        get : function () {
          var a = [
            0, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 1, 0,
            0, 0, 0, 1
          ];
          // Rotate 90 degrees counterclockwise around the Y axis.
          var Try = [
            Math.cos(Math.PI/2), 0, Math.sin(Math.PI/2), 0,
            0, 1, 0, 0,
            -Math.sin(-Math.PI/2),0, Math.cos(-Math.PI/2), 0,
            0, 0, 0, 1
          ];
          return matrixDotProductMatrix(a, Try);
        }
      },
      isometric : {
        get : function (a, b) {
          // https://en.wikipedia.org/wiki/Isometric_projection
          a = a == undefined ? Math.PI / 180 * -35.264 : a;
          b = b == undefined ? Math.PI / 180 * 45 : b;
          var Trx = [
            1, 0, 0, 0,
            0, Math.cos(a), Math.sin(a), 0,
            0, -Math.sin(a), Math.cos(a), 0,
            0, 0, 0, 1
          ];
          var Try = [
            Math.cos(b), 0, -Math.sin(b), 0,
            0, 1, 0, 0,
            Math.sin(b), 0, Math.cos(b), 0,
            0, 0, 0, 1
          ];
          var t = matrixDotProductMatrix(Trx, Try);
          var th = [
            1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 0, 0,
            0, 0, 0, 1
          ];
          return matrixDotProductMatrix(t, th);
        }
      },
      isometric2 : {
        get : function () {
          var a = Math.PI / 180 * 20.7;
          var b = Math.PI / 180 * 19.47;
          return drawStrategy["isometric"]["get"](a, b);
        }
      }
    };

    function dotProduct(a, b) {
      var result = [];
      result[0] = a[0] * b[0] + a[1] * b[4] + a[2] * b[8] + 1 * b[12];
      result[1] = a[0] * b[1] + a[1] * b[5] + a[2] * b[9] + 1 * b[13];
      result[2] = a[0] * b[2] + a[1] * b[6] + a[2] * b[10] + 1 * b[14];
      return result;
    }

    function matrixDotProductMatrix(a, b) {
      var result = [];
      result[0] = a[0] * b[0] + a[1] * b[4] + a[2] * b[8] + a[3] * b[12];
      result[1] = a[0] * b[1] + a[1] * b[5] + a[2] * b[9] + a[3] * b[13];
      result[2] = a[0] * b[2] + a[1] * b[6] + a[2] * b[10] + a[3] * b[14];
      result[3] = a[0] * b[3] + a[1] * b[7] + a[2] * b[11] + a[3] * b[15];

      result[4] = a[4] * b[0] + a[5] * b[4] + a[6] * b[8] + a[7] * b[12];
      result[5] = a[4] * b[1] + a[5] * b[5] + a[6] * b[9] + a[7] * b[13];
      result[6] = a[4] * b[2] + a[5] * b[6] + a[6] * b[10] + a[7] * b[14];
      result[7] = a[4] * b[3] + a[5] * b[7] + a[6] * b[11] + a[7] * b[15];

      result[8] = a[8] * b[0] + a[9] * b[4] + a[10] * b[8] + a[11] * b[12];
      result[9] = a[8] * b[1] + a[9] * b[5] + a[10] * b[9] + a[11] * b[13];
      result[10] = a[8] * b[2] + a[9] * b[6] + a[10] * b[10] + a[11] * b[14];
      result[11] = a[8] * b[3] + a[9] * b[7] + a[10] * b[11] + a[11] * b[15];

      result[12] = a[12] * b[0] + a[13] * b[4] + a[14] * b[8] + a[15] * b[12];
      result[13] = a[12] * b[1] + a[13] * b[5] + a[14] * b[9] + a[15] * b[13];
      result[14] = a[12] * b[2] + a[13] * b[6] + a[14] * b[10] + a[15] * b[14];
      result[15] = a[12] * b[3] + a[13] * b[7] + a[14] * b[11] + a[15] * b[15];
      return result;
    }
  </script>
</div>

<div id="btn">
  <button onclick="draw('frontView')">frontView</button>
  <button onclick="draw('topView')">topView</button>
  <button onclick="draw('sideView')">sideView</button>
  <button onclick="draw('isometric')">isometric</button>
  <button onclick="draw('isometric2')">isometric2</button>
</div>

</body>
</html>
